#!/usr/bin/env bash
set -euo pipefail

IMAGE="m13paiva/hulk:dev"

# Pull if missing (optional; comment out to skip)
if ! docker image inspect "$IMAGE" >/dev/null 2>&1; then
  echo "Pulling $IMAGE..."
  docker pull "$IMAGE"
fi

args=(
  --rm
  -u "$(id -u)":"$(id -g)"
  -v "$PWD:/app"
  -w /app
)

# Allocate a pseudo-TTY only when stdout is a terminal (enables tqdm bars)
if [ -t 1 ]; then
  args+=( -it --init )
fi

# Optional: persistent SRA cache
# cache="$HOME/ncbi/public/sra"
# if [[ -d "$cache" ]]; then
#   args+=( -v "$cache:/root/ncbi/public/sra" )
# fi

exec docker run "${args[@]}" "$IMAGE" "$@"

